# 8ì¥ ë¦¬ì•¡íŠ¸ ë°ì´í„° ê´€ë¦¬

> ì´ ì¥ì€ â€œë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ëˆ„ìˆ˜â€, Prop Drilling, ê·¸ë¦¬ê³  ì´ë¥¼ ì¤„ì´ê¸° ìœ„í•œ ACL(ì˜¤ë¥˜ ë°©ì§€ ê³„ì¸µ)Â·Context ì „ëµì„ ë‹¤ë£¬ë‹¤. 

## 8.1 ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ëˆ„ìˆ˜ í˜„ìƒ

ğŸ¤” ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì´ë€?
- ì–´í”Œë¦¬ì¼€ì´ì…˜ì„ ìš´ì˜í•˜ê¸° ìœ„í•œ ì •ì±…, ê³„ì‚° ë¡œì§, ì ˆì°¨ ë“±ì„ ì˜ë¯¸í•¨

ğŸ¦â€ğŸ”¥ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ëˆ„ìˆ˜ë€?
- ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ê³¼ ê´€ë ¨ ì—†ëŠ” ì»´í¬ë„ŒíŠ¸ë‚˜ ì–´í”Œë¦¬ì¼€ì´ì…˜ ì˜ì—­ìœ¼ë¡œ í˜ëŸ¬ ë“¤ì–´ê°€ëŠ” í˜„ìƒ
- ë¡œì§ê³¼ ê°•í•œ ê²°í•©ì„ ë‚˜íƒ€ë‚´ëŠ” ì»´í¬ë„ŒíŠ¸ë¥¼ ë§Œë“¤ì–´ëƒ„ > í…ŒìŠ¤íŠ¸, ìœ ì§€ë³´ìˆ˜ë¥¼ ì–´ë µê²Œ í•¨
- ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì´ ì–´í”Œë¦¬ì¼€ì´ì…˜ ì „ë°˜ì— ê±¸ì³ í©ì–´ì ¸ ìˆìœ¼ë©´ ì½”ë“œ ì¤‘ë³µê³¼ ì¼ê´€ì„±ì´ ë¶€ì¡±í•´ì§€ëŠ” í˜„ìƒì´ ë°œìƒí•œë‹¤.

ğŸ«  ê°€ì¥ í”í•œ ì˜ˆ : presentational í•œ ì»´í¬ë„ŒíŠ¸ì—ì„œ ë°ì´í„° ë³€ê²½í•˜ê¸°

```tsx
import React from "react";
import { User } from "../types";

export default function UserProfile({ user }: { user: User }) {
  const [user, setUser] = useState<User | null>(null);

  useEffect(() => {
    async function fetchUser() {

    cosnt response = await fetch(`/api/users/${id}`);
    const data = await response.json();
    
    setUser({
        id: data.user_identifiaction,
        name: data.user_full_name,
        isPremium: data.is_premium_user,
        subscription: data.subscription_details.level,
        expire: data.subscription_details.expiry,
      });
    }

    fetchUser();
  }, [id]):


  if(!user) {
    return <div>Loading... </div>
  }

  return (
    <div data-testid="user-profile">
      <h1>{user.name}</h1>
    </div>
  );
}
```

ğŸ” ê·¸ë˜ì„œ ì €ë ‡ê²Œ í•˜ë©´ ë­ê°€ ë¬¸ì œì¸ë° ?
- ë°±ì—”ë“œë‘ ì£¼ê³  ë°›ëŠ” ë°ì´í„°ì˜ í˜•ì‹ì´ í”„ë¡ íŠ¸ì—ì„œ ì‹¤ì œ ë…¸ì¶œí•˜ëŠ” ë°ì´í„° í˜•ì‹ê³¼ ë‹¤ë¥¼ ìˆ˜ ìˆìŒ.
  - xml ë°ì´í„°ë¥¼ ë‚´ë¶€ íƒ€ì…ìœ¼ë¡œ ë³€í™˜í•˜ê¸°ë„ í•˜ê³ , GraphQL ì—”ë“œí¬ì¸íŠ¸ë¥¼ í†µí•´ ë°›ì€ ë°ì´í„°ì™€ ë™ì¼í•œ í˜•íƒœì˜ ë‚´ë¶€íƒ€ì…ìœ¼ë¡œ ë³€í™˜í•˜ëŠ” ë“±..
  - ì½”ë“œ ì˜ì—­ì—ì„œ ë°ì´í„° ë³€í™˜ì´ í•„ìš”í•œë°, ì½”ë“œë§ˆë‹¤ ì´ëŸ° ë³€í™˜ ì‘ì—…ì´ ë“¤ì–´ê°€ë©´, ìœ ì§€ë³´ìˆ˜ê°€ í˜ë“¤ê³  ë†“ì¹˜ëŠ” ë¶€ë¶„ ë°œìƒ.
- ë°±ì—”ë“œì—ì„œ `null`, `undefined` ê°™ì€ ë¹ˆ ê°’ ë°ì´í„°ê°€ ì™”ì„ ê²½ìš°ì˜ ìœ ì €ì—ê²Œ ë…¸ì¶œë˜ëŠ” UI ì²˜ë¦¬ë¥¼ ê°œë³„ì ìœ¼ë¡œ í•´ì•¼ í•¨.

## 8.2 ACL(ì˜¤ë¥˜ ë°©ì§€ ê³„ì¸µ, Anti-Corruption Layer)

ì˜ë„: ì™¸ë¶€/ë¶ˆì•ˆì • ì†ŒìŠ¤(REST/3rd-party)ì—ì„œ ì˜¤ëŠ” í˜•ì‹/ëª…ì„¸ ì°¨ì´ë¥¼ â€œìš°ë¦¬ ì•± ë‚´ë¶€ ëª¨ë¸â€ë¡œ ê²©ë¦¬/ì •ê·œí™”í•´ ë¡œì§ ëˆ„ìˆ˜ë¥¼ ë§‰ëŠ”ë‹¤.

ì˜ˆì‹œ ì½”ë“œ â€” ì™¸ë¶€ API â†’ ë‚´ë¶€ ëª¨ë¸ ë³€í™˜

// external/api.ts (ì™¸ë¶€ ì‘ë‹µ ì˜ˆì‹œ)
export type RawUser = { id: string; vip_flag?: 0|1; name?: string | null };

// acl/userMapper.ts (ACL: ì™¸ë¶€ â†’ ë‚´ë¶€ ì •ê·œí™”)
export type User = { id: string; isVip: boolean; name: string };

export function mapUser(raw: RawUser): User {
  return {
    id: raw.id,
    isVip: raw.vip_flag === 1,
    name: raw.name ?? 'ì†ë‹˜',
  };
}

// app/repos/userRepo.ts (ACLì„ ê²½ìœ )
import { mapUser, User } from '@/acl/userMapper';
export async function fetchUser(id: string): Promise<User> {
  const res = await fetch(`/api/users/${id}`).then(r => r.json());
  return mapUser(res); // ë‚´ë¶€ë¡œëŠ” í•­ìƒ User ë³´ì¥
}


í…ŒìŠ¤íŠ¸ í¬ì¸íŠ¸

ACLì€ ëŸ°íƒ€ì„ ê°€ë“œ(zod/io-ts)ì™€ í•¨ê»˜ ì“°ë©´ íš¨ê³¼â†‘.

UI/ì„œë¹„ìŠ¤ëŠ” Userë§Œ ì•Œë©´ ë˜ë¯€ë¡œ ì™¸ë¶€ í•„ë“œ ë³€ê²½ì—ë„ ì•ˆì •ì .

8.3 Prop Drilling ë¬¸ì œ ì‚´í´ë³´ê¸°

ì¦ìƒ: ê¹Šì€ í•˜ìœ„ì—ì„œ í•„ìš”í•œ ê°’/í–‰ë™ì„ ìœ„í•´ â€œì¤‘ê°„ ì»´í¬ë„ŒíŠ¸ê°€ ê´€ì‹¬ ì—†ëŠ” propsâ€ë¥¼ ê³„ì† ì „ë‹¬. ìœ ì§€ë³´ìˆ˜/ê°€ë…ì„±/ì¬ì‚¬ìš©ì„± ì €í•˜. (í•­ëª© ê·¼ê±°) 
FlipHTML5

ì˜ˆì‹œ ì½”ë“œ â€” Drillingì´ ì‹¬í•œ êµ¬ì¡°

// App -> PageLayout -> Toolbar -> UserMenu -> Avatar
export function App(){ return <PageLayout userName="ë³´ë¼" /> }
function PageLayout({ userName }: { userName:string }){ return <Toolbar userName={userName}/> }
function Toolbar({ userName }: { userName:string }){ return <UserMenu userName={userName}/> }
function UserMenu({ userName }: { userName:string }){ return <Avatar label={userName}/> }
function Avatar({ label }:{label:string}){ return <span>{label}</span> }

8.4 Context APIë¡œ Prop Drilling ì™„í™”

í•´ê²°ì±…: ê³µí†µ ìƒíƒœ/ì„œë¹„ìŠ¤ë¥¼ Contextë¡œ ë…¸ì¶œí•´ ì¤‘ê°„ ì „ë‹¬ ì œê±°.

ì£¼ì˜: Context ê°’ ë³€ê²½ì€ êµ¬ë… íŠ¸ë¦¬ ì „ì²´ ì¬ë Œë” ìœ ë°œ ê°€ëŠ¥â€”ë¶„í• /ë©”ëª¨Â·ì…€ë ‰í„° íŒ¨í„´ ê³ ë ¤. (ì¥ ê°œìš”Â·ë¬¸ë§¥) 
FlipHTML5

ì˜ˆì‹œ ì½”ë“œ â€” Context + Selector ìµœì†Œí™”

import React, { createContext, useContext, useMemo } from 'react';

type User = { name: string; isVip: boolean };
const UserCtx = createContext<User | null>(null);

export function UserProvider({ children }: React.PropsWithChildren) {
  // ì‹¤ì œë¡œëŠ” fetch + ACL ë§¤í•‘ì„ í†µí•´ User í™•ë³´
  const value = useMemo<User>(() => ({ name: 'ë³´ë¼', isVip: true }), []);
  return <UserCtx.Provider value={value}>{children}</UserCtx.Provider>;
}

// ì…€ë ‰í„° í—¬í¼
export function useUser<T>(selector: (u: User) => T): T {
  const u = useContext(UserCtx);
  if (!u) throw new Error('UserProvider ëˆ„ë½');
  return selector(u);
}

// ì†Œë¹„ì: í•„ìš”í•œ ì¡°ê°ë§Œ ë½‘ê¸°
export function Avatar() {
  const name = useUser(u => u.name);
  return <span>{name}</span>;
}
